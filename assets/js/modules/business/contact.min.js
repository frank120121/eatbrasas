import{CONFIG,CONTACT_INFO}from"../config.js";import{getElements,attachEventListeners}from"../utils.js";export class ContactManager{constructor(t=null){this.showToast=t,this.isInitialized=!1,this.copyAttempts=new Map}init(){try{this.initContactElements(),this.initCopyAddressButtons(),this.initPhoneAndEmailLinks(),this.initWhatsAppLinks(),this.isInitialized=!0,console.log("✅ Contact functionality initialized")}catch(t){console.error("❌ Error initializing contact functions:",t),this.showToast&&this.showToast("Error al inicializar funciones de contacto","error")}}initCopyAddressButtons(){const t=attachEventListeners('button[onclick="copyAddress()"]',"click",t=>{t.preventDefault(),this.copyAddress(t)});t>0&&console.log(`✅ Initialized ${t} copy address buttons`)}initPhoneAndEmailLinks(){const t=getElements('a[href^="tel:"]');t.forEach(t=>{t.href=`tel:${CONTACT_INFO.phone}`,t.textContent.trim()||(t.textContent=CONTACT_INFO.phoneDisplay)});const e=getElements('a[href^="mailto:"]');e.forEach(t=>{t.href=`mailto:${CONTACT_INFO.email}`,t.textContent.trim()||(t.textContent=CONTACT_INFO.email)}),(t.length>0||e.length>0)&&console.log(`✅ Updated ${t.length} phone links and ${e.length} email links`)}initWhatsAppLinks(){const t=getElements('a[href*="wa.me"], a[href*="whatsapp.com"]');t.length>0&&(t.forEach(t=>{t.href=CONTACT_INFO.whatsappUrl,t.addEventListener("click",()=>{console.log("WhatsApp link clicked")})}),console.log(`✅ Updated ${t.length} WhatsApp links to the primary business URL.`))}copyTextToClipboard(t,e,s,o="default"){const n=Date.now();n-(this.copyAttempts.get(o)||0)<1e3?this.showToast&&this.showToast("Por favor espera antes de copiar de nuevo","warning",2e3):(this.copyAttempts.set(o,n),navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(e).catch(()=>this.fallbackCopyText(t,e,s)):this.fallbackCopyText(t,e,s))}fallbackCopyText(t,e,s){const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",o.setAttribute("readonly",""),document.body.appendChild(o),o.select();try{document.execCommand("copy")?e():s()}catch(t){s()}finally{o.remove()}}copyAddress(t){this.copyTextToClipboard(CONFIG.BUSINESS.ADDRESS,()=>this.showCopySuccess(t),()=>this.showToast("No se pudo copiar la dirección","error"),"address")}showCopySuccess(t,e="¡Copiado!"){const s=t?t.target.closest("button"):null;if(s){const t=s.innerHTML;s.innerHTML=`\n                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">\n                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n                </svg>\n                <span>${e}</span>`,s.classList.add("text-green-600"),s.disabled=!0,setTimeout(()=>{s.innerHTML=t,s.classList.remove("text-green-600"),s.disabled=!1},2e3)}this.showToast("¡Dirección copiada al portapapeles!","success")}trackWhatsAppClick(t){console.log("WhatsApp interaction:",{message:t.substring(0,50)+"..."})}initContactElements(){getElements('[data-contact="address"]').forEach(t=>t.textContent=CONTACT_INFO.address.full),getElements('[data-contact="phone"]').forEach(t=>t.textContent=CONTACT_INFO.phoneDisplay),getElements('[data-contact="email"]').forEach(t=>t.textContent=CONTACT_INFO.email)}destroy(){this.copyAttempts.clear(),this.isInitialized=!1,console.log("Contact manager destroyed")}}export const contactManager=new ContactManager;